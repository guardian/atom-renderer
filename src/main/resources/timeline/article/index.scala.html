@import com.gu.contentatom.renderer.utils.GuardianDateFormatter
@import com.gu.contentatom.thrift.atom.timeline.TimelineItem
@(atom: com.gu.contentatom.thrift.Atom,
        data: com.gu.contentatom.thrift.atom.timeline.TimelineAtom
)

@renderFormattedDate(item: TimelineItem, format: String) = @{

  item.toDate match {
    case Some(date) => {
      val beginRange = GuardianDateFormatter.toCustomFormat(item.date, format)
      val endRange = GuardianDateFormatter.toCustomFormat(date, format)
      s"$beginRangeâ€“$endRange"
    }
    case None => GuardianDateFormatter.toCustomFormat(item.date, format)
  }
}

@fragments.atoms.html.snippet(
  atom.id,
  className = "timeline",
  label = data.typeLabel.getOrElse("Timeline"),
  headline = atom.title.getOrElse("")
){
  @for(description <- data.description) {
    <div class="atom--snippet__description">@Html(description)</div>
  }
  @for(item <- data.events) {
    <div class="atom--snippet__item">
      <time class="atom--snippet__event-date" datetime="">
      @item.dateFormat match {
        case Some("month-year") => { @renderFormattedDate(item , "MMMM uuuu") }
        case Some("year") => { @renderFormattedDate(item, "uuuu") }
        case _ => { @renderFormattedDate(item, "d MMMM uuuu") }
      }
      </time>
      <div class="atom--snippet__heading"><b>@item.title</b></div>
      @item.body.map { body => @Html(body) }
    </div>
  }
}
